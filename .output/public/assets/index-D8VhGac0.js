import{R as A,j as e,r as o,b as $,a as O,u as M,t as i}from"./main-CjkQDEVS.js";import{B as N,u as S}from"./button-D25r5iFi.js";import{I as v}from"./input-JBUyXG4k.js";import{T as U,S as V,a as K,b as q,c as B,d as I,f as Q,C as z,e as G,g as H,h as J,L as R,i as X}from"./calendar-inVojtzy.js";import{c as Y,l as Z,n as ee,o as se,p as te}from"./index-JW4W9o4z.js";import{u as P,d as ae,b as W,c as re}from"./ragServices-DomIpkg1.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],ne=Y("globe",le),D=A.forwardRef(({size:l=14,strokeWidth:c=2,title:n="Retry",className:s,...r},d)=>e.jsxs("svg",{ref:d,width:l,height:l,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-label":n,role:"img",className:s,...r,children:[e.jsx("title",{children:n}),e.jsx("path",{d:"M21 12a9 9 0 10-3.2 6.6",stroke:"currentColor",strokeWidth:c,strokeLinecap:"round",strokeLinejoin:"round",fill:"none"}),e.jsx("path",{d:"M21 3v6h-6",stroke:"currentColor",strokeWidth:c,strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})]}));D.displayName="RetryIcon";function oe({deleteMutation:l,retryMutation:c}){const n=s=>{const r={urls:[{id:s.id,base_url:s.web_url,web_id:s.web_id,page_title:s.pageTitle}],tags:[],category:"demo",context:""};c.mutate(r)};return[{accessorFn:s=>s.web_id,id:"web_id",header:()=>e.jsx("span",{children:"Website Id"}),footer:s=>s.column.id,cell:s=>e.jsx("span",{className:"text-gray-500 text-sm",children:s.getValue()}),minWidth:100,maxWidth:150},{accessorFn:s=>s.web_url,id:"web_url",header:()=>e.jsx("span",{children:"URL"}),footer:s=>s.column.id,cell:s=>e.jsx("div",{className:"truncate",title:s.getValue(),style:{maxWidth:260},children:e.jsx("a",{href:s.getValue(),target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline text-sm",children:s.getValue()})}),minWidth:100,maxWidth:200},{accessorFn:s=>s.pageTitle,id:"pageTitle",header:()=>e.jsx("span",{children:"Page Title"}),footer:s=>s.column.id,cell:s=>e.jsx("span",{className:"text-gray-700 text-sm hover:underline",children:s.getValue()}),minWidth:60,maxWidth:100},{accessorFn:s=>s.scrape_status,id:"scrape_status",header:()=>e.jsx("span",{children:"Scrape Status"}),footer:s=>s.column.id,cell:s=>{const r=s.getValue();return e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-md ${r==="COMPLETED"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:r})},minWidth:180,maxWidth:180},{accessorFn:s=>s.ragStatus,id:"rag_status",header:()=>e.jsx("span",{children:"Rag Status"}),footer:s=>s.column.id,cell:s=>{const r=s.getValue();return e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-md ${r==="COMPLETED"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:r})},minWidth:180,maxWidth:180},{accessorFn:s=>s.id,id:"actions",header:()=>e.jsx("span",{children:"ACTIONS"}),footer:s=>s.column.id,cell:s=>{const r=s.row.original;return e.jsxs("div",{className:"flex gap-1 items-center justify-center",children:[r.scrape_status==="FAILED"&&e.jsx(N,{onClick:()=>n(r),className:"bg-white hover:bg-white text-black",children:e.jsx(D,{})}),e.jsx(U,{className:"hover:text-red-700 transition-colors cursor-pointer",style:{width:16,height:16,color:"#dc2626"},onClick:()=>l.mutate(r.id)})]})},minWidth:80,maxWidth:100}]}function ie(){const[l,c]=o.useState(1),[n,s]=o.useState(15),r=$(),[d,y]=o.useState(void 0),{selectedWorkspace:x}=O(),p=a=>{if(!a)return y(void 0);y(Array.isArray(a)?a[0]:a)},b=M(),{data:m,isPending:w}=Z({queryKey:["scraped-files-list",l,n,x?.id],queryFn:async()=>{const a=x?.id?await W(`/files/upload/scraped?page=${l}&limit=${n}&user_id=${x?.id}`):await W(`/files/upload/scraped?page=${l}&limit=${n}`);return a?.status===200||a?.status===201?a.data:(i.error(a?.message||"Something went wrong while fetching files..."),a)},refetchOnWindowFocus:!1}),k=S({mutationKey:["upload-scrape-files-into-rag"],mutationFn:async a=>await P("/scrape/scrape-and-save",a),onSuccess:()=>{b.invalidateQueries({queryKey:["scraped-files-list"]}),i.success("Selected links uploaded successfully!")},onError:a=>{i.error(a?.message||"Failed to upload links")}}),j=S({mutationKey:["scraped-file-delete"],mutationFn:async a=>await ae(`/files/upload/scraped/${a}`),onSuccess:()=>{i.success("file is deleted...")},onError:a=>{i.error(a?.message||"file deletion error...")}});r.navigate({to:"/mainLayout/urls",params:{page:l},search:{page:l,limit:n}});const C=o.useMemo(()=>m?.data?.records?Array.isArray(m.data.records)?m.data.records:[]:[],[m?.data?.records]),L=m?.data?.paginationInfo,F=o.useMemo(()=>oe({deleteMutation:j,retryMutation:k}),[]),_=({page:a,limit:h})=>{c(a),s(h)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-2 md:gap-0 md:justify-between  mr-2",children:[e.jsx("div",{}),e.jsxs("div",{className:"flex flex-wrap gap-2 md:gap-4 items-center pb-1",children:[e.jsxs(V,{children:[e.jsx(K,{className:"w-[180px] bg-white",children:e.jsx(q,{placeholder:"Select"})}),e.jsxs(B,{children:[e.jsx(I,{value:"option1",children:"Option 1"}),e.jsx(I,{value:"option2",children:"Option 2"})]})]}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:`w-[180px] justify-start text-left font-normal ${!d&&"text-muted-foreground"} border-1 border-gray-200`,children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),d?Q(d,"PPP"):"Select Date"]})}),e.jsx(te,{className:"w-auto p-0",align:"start",children:e.jsx(G,{mode:"single",selected:d,onSelect:p,initialFocus:!0})})]}),e.jsxs("div",{className:"relative w-full sm:w-[200px]",children:[e.jsx(H,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(v,{type:"text",placeholder:"Search",className:"pl-8 bg-white"})]})]})]}),e.jsx("div",{className:"overflow-hidden ",children:e.jsx(J,{data:C,columns:F,paginationDetails:L||{},getData:_,loading:w,removeSortingForColumnIds:["serial","actions"],heightClass:"h-[calc(100vh-238px)]",noDataLabel:"files",noDataDescription:"No files available",showNoDataIcon:!0})})]})}function ce(){const[l,c]=o.useState([]),[n,s]=o.useState(""),[r,d]=o.useState([]),y=M(),[x,p]=o.useState(!1),[b,m]=o.useState(""),[w,k]=o.useState(""),[j,C]=o.useState(""),L=S({mutationKey:["crawl-links"],mutationFn:async t=>await re("/scrape/get-scrape-urls",t),onSuccess:t=>(c(u=>[...u,...t?.data.data.urls]),t?.data),onError:t=>{i.error(t?.message||"Scraping sub pages for this website failed..")}}),F=S({mutationKey:["upload-scrape-files-into-rag"],mutationFn:async t=>await P("/scrape/scrape-and-save",t),onSuccess:()=>{y.invalidateQueries({queryKey:["scraped-files-list"]}),i.success("Selected links uploaded successfully!")},onError:t=>{i.error(t?.message||"Failed to upload links")}});async function _(){try{if(p(!0),n===""){i.error("please paste the url to scrape"),p(!1);return}await L.mutateAsync({base_url:n})}catch(t){console.error("Scraping failed:",t)}}async function a(){if(r.length===0){i.error("Please select at least one link to upload!");return}try{const t=b.split(","),u={urls:r.map(f=>{const E=new URL(f).hostname;let T=f.split("/").pop();return T||(T="Home"),{base_url:f,web_id:E,page_title:T}}),tags:t,category:j,context:w};await F.mutateAsync(u)&&c([])}catch(t){console.error("Upload failed:",t)}}function h(t,u){d(g=>u?[...g,t]:g.filter(f=>f!==t))}return e.jsxs("div",{className:"flex flex-col lg:flex-row gap-2",children:[e.jsx("div",{className:"h-auto lg:h-[calc(100vh-144px)] w-full lg:w-[380px] bg-blue-50 border border-gray-200 ml-2 rounded-md overflow-y-auto shadow-sm",children:e.jsxs("div",{className:"flex flex-col gap-5 p-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Website URL"}),e.jsxs("div",{className:"flex items-center flex-col gap-2",children:[e.jsx(v,{placeholder:"Paste the URL",className:"w-full rounded-md border bg-white border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-green-500 focus:ring-green-500",value:n,onChange:t=>s(t.target.value)}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsxs(N,{onClick:_,className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2 px-4 py-2 rounded-md h-7 text-xs 3xl:text-sm",disabled:x,children:[e.jsx(ne,{size:16}),e.jsx("span",{children:"Scrape & Process"})]})})]})]}),l.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Created RAG Files"}),e.jsx("div",{className:"h-[200px] overflow-y-auto rounded-md bg-white shadow-sm",children:e.jsx("ul",{className:"space-y-3 p-2",children:l.map((t,u)=>e.jsx("li",{className:"flex items-start gap-2 rounded-lg border border-gray-200 bg-white p-3 shadow-sm hover:bg-gray-50",children:t?.flag===!0?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"checkbox",className:"mt-1 cursor-not-allowed",title:"This link is already uploaded",disabled:!0}),e.jsx("div",{className:"flex flex-col max-w-full",children:e.jsx("a",{href:t?.url||"#",className:"text-sm text-blue-600 hover:underline break-words max-w-full",target:"_blank",rel:"noreferrer",children:t?.url||"https://www.saletable.ai/product/reporting/"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"checkbox",className:"mt-1 cursor-pointer",onChange:g=>h(t.url,g.target.checked)}),e.jsx("div",{className:"flex flex-col max-w-full",children:e.jsx("a",{href:t?.url||"#",className:"text-xs text-blue-600 break-words hover:underline",target:"_blank",rel:"noreferrer",children:t?.url||"https://www.saletable.ai/product/reporting/"})})]})},u))})}),e.jsxs("div",{className:"space-y-4 w-full mt-5",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx(R,{className:"text-sm font-medium text-gray-700",children:"Tags"}),e.jsx(v,{placeholder:"Enter Tags",type:"text",className:"rounded-md border bg-white border-gray-300 px-3 py-2 text-sm shadow-sm focus:ring-2 focus:ring-green-500",value:b,onChange:t=>m(t.target.value)})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx(R,{className:"text-sm font-medium text-gray-700",children:"Category"}),e.jsx(v,{placeholder:"Enter Category",className:"rounded-md border bg-white border-gray-300 px-3 py-2 text-sm shadow-sm focus:ring-2 focus:ring-green-500",value:j,onChange:t=>C(t.target.value)})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx(R,{className:"text-sm font-medium text-gray-700",children:"Context"}),e.jsx(X,{placeholder:"Enter Context",className:"rounded-md border bg-white border-gray-300 px-3 py-2 text-sm h-24 resize-none shadow-sm focus:ring-2 focus:ring-green-500",value:w,onChange:t=>k(t.target.value)})]})]}),e.jsx("div",{className:"mt-5",children:e.jsx(N,{className:"w-full bg-blue-600 hover:bg-blue-600 text-white text-sm font-medium py-2 rounded-md",onClick:()=>{a(),d([]),s(""),p(!1)},children:"Submit"})})]})]})}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-md shadow-sm flex-1 overflow-x-auto mr-2 p-1",children:e.jsx(ie,{})})]})}function fe(){return e.jsx(e.Fragment,{children:e.jsx(ce,{})})}export{fe as component};
